@model NutricionWeb.Models.Paciente.PacienteViewModel

@helper AgregarVista(string idVista, string idParcial)
{
    <div id="@idVista" class="tab-pane fade in active">
        <div id="@idParcial"></div>
    </div>
}

@helper AgregarTabs(string idTab, string idVista, string texto, string clase)
{
    <li class="@clase" id="@idTab"><a data-toggle="tab" href="#@idVista">@texto</a></li>
}

<div class="titulo-ABM">
    <h4 class="create-h4">@Model.ApyNom</h4>
</div>



<ul class="nav nav-tabs">
    @if (User.IsInRole("Administrador"))
    {
        @AgregarTabs("datosAntropometricos", "datosAntropometricos-Vista", "Datos Atropometricos", "active")
        @AgregarTabs("planesAlimenticios", "planesAlimenticios-Vista", "Planes Alimenticios", "")
        @AgregarTabs("datosAnaliticos", "datosAnaliticos-Vista", "Datos Analiticos", "")
    }
  
    @AgregarTabs("turnos", "turnos-Vista", "Turnos", "")
    @AgregarTabs("anamnesis", "anamnesis-Vista", "Anamnesis", "")
    @AgregarTabs("objetivo", "objetivo-Vista", "Objetivo", "")
    @AgregarTabs("estrategia", "estrategia-Vista", "Estrategia", "")
    @AgregarTabs("observaciones", "observaciones-Vista", "Observaciones", "")
    @AgregarTabs("estadisticas", "estadisticas-Vista", "Estadisticas", "")
</ul>

<div class="tab-content" style="max-width: 100vw;">
    @if (User.IsInRole("Administrador"))
    {
        @AgregarVista("datosAntropometricos-Vista", "datosAntropometricos-Parcial")
        @AgregarVista("planesAlimenticios-Vista", "planesAlimenticios-Parcial")
        @AgregarVista("datosAnaliticos-Vista", "datosAnaliticos-Parcial")
    }

    @AgregarVista("turnos-Vista", "turnos-Parcial")
    @AgregarVista("anamnesis-Vista", "anamnesis-Parcial")
    @AgregarVista("objetivo-Vista", "objetivo-Parcial")
    @AgregarVista("estrategia-Vista", "estrategia-Parcial")
    @AgregarVista("observaciones-Vista", "observaciones-Parcial")
    @AgregarVista("estadisticas-Vista", "estadisticas-Parcial")
</div>

@section scripts
{
    <script type="text/javascript">
        //=======================JavaScriptPuro==========================

        var datosAntropometricos = function() {
            var url = '@Url.Action("DatosAntropometricosParcial", "Paciente")';
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url + "?id=" + @Model.Id, true);
            xhr.send();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById("datosAntropometricos-Parcial").innerHTML = "";
                    document.getElementById("datosAntropometricos-Parcial").innerHTML = xhr.response;
                }
            }
        }

        var planesAlimenticios = function() {
            var url = '@Url.Action("PlanesAlimenticiosParcial", "Paciente")';
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url + "?id=" + @Model.Id, true);
            xhr.send();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById("planesAlimenticios-Parcial").innerHTML = "";
                    document.getElementById("planesAlimenticios-Parcial").innerHTML = xhr.response;
                }
            }
        }

        var datosAnaliticos = function() {
            var url = '@Url.Action("DatosAnaliticosParcial")';

            var xhr = new XMLHttpRequest();
            xhr.open("GET", url + "?id=" + @Model.Id, true);
            xhr.send();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById("datosAnaliticos-Parcial").innerHTML = "";
                    document.getElementById("datosAnaliticos-Parcial").innerHTML = xhr.response;
                }
            }

        }

        var turnos = function() {
            var url = '@Url.Action("TurnosParcial")';
            $.get(url, {id : @Model.Id}, function (parcial) {
                $("#turnos-Parcial").empty();
                $("#turnos-Parcial").append(parcial);
            });
        }

        var objetivo = function() {
            var url = '@Url.Action("ObjetivosParcial")';
            $.get(url,
                { id: @Model.Id },
                function (parcial) {
                    console.log(parcial);
                    $("#objetivo-Parcial").empty();
                    $("#objetivo-Parcial").append(parcial);
                });
        }

        var anamnesis = function() {
            var url = '@Url.Action("AnamnesisParcial")';
            $.get(url,
                { id: @Model.Id },
                function (parcial) {
                    console.log(parcial);
                    $("#anamnesis-Parcial").empty();
                    $("#anamnesis-Parcial").append(parcial);
                });
        }

        var estrategia = function() {
            var url = '@Url.Action("EstrategiaParcial")';
            $.get(url,
                { id: @Model.Id },
                function (parcial) {
                    console.log(parcial);
                    $("#estrategia-Parcial").empty();
                    $("#estrategia-Parcial").append(parcial);
                });
        }

        var observaciones = function () {
            @if (Model.TieneObservacion) {
                <text>var url = '@Url.Action("ObservacionesParcial")';
                    $.get(url,
                        { id: @Model.Id },
                        function (parcial) {
                            $("#observaciones-Parcial").empty();
                            $("#observaciones-Parcial").append(parcial);
                        });</text>
            }
            else {
                <text>var url2 = '@Url.Action("CreateParcial", "Observacion")';
                    $.get(url2,
                        { id: @Model.Id },
                        function (parcial) {
                            $("#observaciones-Parcial").empty();
                            $("#observaciones-Parcial").append(parcial);
                        });</text>
            }
        }

        var estadisticas = function() {

            var url = '@Url.Action("Index", "Estadisticas")';
            $.get(url, { id: @Model.Id}, function (parcial) {

                $("#estadisticas-Parcial").empty();
                $("#estadisticas-Parcial").append(parcial);
            });

        }

        var inicio = function() {

            @if (User.IsInRole("Administrador"))
            {
                @:datosAntropometricos();

                <text>
                    document.getElementById("datosAntropometricos").addEventListener("click",
                        function() {
                            datosAntropometricos();
                        });

                    document.getElementById("planesAlimenticios").addEventListener("click",
                        function () {
                            planesAlimenticios();
                        });

                    document.getElementById("datosAnaliticos").addEventListener("click",
                        function() {
                            datosAnaliticos();
                        });
                </text>
             }else {
                 @:turnos();
                 @: $("#turnos").addClass("active");
             }




            document.getElementById("turnos").addEventListener("click",
                function() {
                    turnos();
                });
            document.getElementById("estadisticas").addEventListener("click",
                function() {
                    estadisticas();
                });
            document.getElementById("objetivo").addEventListener("click",
                function() {
                    objetivo();
                });
            document.getElementById("anamnesis").addEventListener("click",
                function () {
                    anamnesis();
                });
            document.getElementById("observaciones").addEventListener("click",
                function () {
                    observaciones();
                });
            document.getElementById("estrategia").addEventListener("click",
                function () {
                    estrategia();
                });
        };

        window.addEventListener("load", inicio);

    </script>
}
